"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.approveErc20 = void 0;
const tslib_1 = require("tslib");
const utils_1 = require("@rarible/utils");
const erc20_1 = require("./contracts/erc20");
const infiniteBn = (0, utils_1.toBn)(2).pow(256).minus(1);
function approveErc20(ethereum_1, send_1, contract_1, owner_1, operator_1, value_1) {
    return tslib_1.__awaiter(this, arguments, void 0, function* (ethereum, send, contract, owner, operator, value, infinite = true) {
        if (!ethereum) {
            throw new Error("Wallet undefined");
        }
        const erc20 = (0, erc20_1.createErc20Contract)(ethereum, contract);
        const allowance = (0, utils_1.toBn)(yield erc20.functionCall("allowance", owner, operator).call());
        const bnValue = (0, utils_1.toBn)(value);
        if (allowance.lt(bnValue)) {
            if (!infinite) {
                return send(erc20.functionCall("approve", operator, bnValue.toFixed()));
            }
            else {
                return send(erc20.functionCall("approve", operator, infiniteBn.toFixed()));
            }
        }
        else {
            return undefined;
        }
    });
}
exports.approveErc20 = approveErc20;
